name: Init React Project

on:
  workflow_dispatch:
    inputs:
      project_name:
        description: 'Project Name (will be used as new repository name)'
        required: true
        type: string

      node_version:
        description: 'Node.js Version'
        required: true
        type: choice
        options:
          - '18'
          - '20'
          - '22'
        default: '20'

      react_version:
        description: 'React Version'
        required: true
        type: choice
        options:
          - '18'
          - '19'
        default: '19'

      repo_visibility:
        description: 'Repository Visibility'
        required: true
        type: choice
        options:
          - 'public'
          - 'private'
        default: 'public'

jobs:
  create-react:
    runs-on: ubuntu-latest
    steps:
      - name: Validate project name
        run: |
          if [[ ! "${{ inputs.project_name }}" =~ ^[a-zA-Z][a-zA-Z0-9_-]*$ ]]; then
            echo "::error::Invalid project name. Must start with a letter and contain only letters, numbers, hyphens, and underscores."
            exit 1
          fi

      - name: Set up Node.js ${{ inputs.node_version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ inputs.node_version }}

      - name: Create React project
        run: |
          npm create vite@latest ${{ inputs.project_name }} -- --template react-ts
          cd ${{ inputs.project_name }}
          
          # Update React version
          npm pkg set dependencies.react="^${{ inputs.react_version }}.0.0"
          npm pkg set dependencies.react-dom="^${{ inputs.react_version }}.0.0"
          
          # Install dependencies
          npm install
          
          # Add commonly used dev dependencies
          npm install -D @types/node
          
          cat > .gitignore << 'EOF'
          # Dependencies
          node_modules/
          
          # Build
          dist/
          dist-ssr/
          build/
          
          # Environment
          .env
          .env.local
          .env.*.local
          
          # Logs
          logs/
          *.log
          npm-debug.log*
          yarn-debug.log*
          yarn-error.log*
          pnpm-debug.log*
          
          # IDE
          .idea/
          .vscode/*
          !.vscode/extensions.json
          *.suo
          *.ntvs*
          *.njsproj
          *.sln
          *.sw?
          
          # OS
          .DS_Store
          Thumbs.db
          
          # Testing
          coverage/
          
          # Misc
          *.local
          EOF
          
          cat > .env.example << 'EOF'
          VITE_API_URL=http://localhost:3000
          EOF
          
          cat > README.md << 'EOF'
          # ${{ inputs.project_name }}
          
          A React project built with Vite.
          
          ## Tech Stack
          
          - Node.js: ${{ inputs.node_version }}
          - React: ${{ inputs.react_version }}
          - TypeScript
          - Vite
          
          ## Quick Start
          
          ```bash
          # Install dependencies
          npm install
          
          # Start development server
          npm run dev
          
          # Build for production
          npm run build
          
          # Preview production build
          npm run preview
          ```
          
          ## Project Structure
          
          ```
          ${{ inputs.project_name }}/
          ├── public/
          ├── src/
          │   ├── assets/
          │   ├── App.tsx
          │   ├── App.css
          │   ├── main.tsx
          │   └── index.css
          ├── index.html
          ├── package.json
          ├── tsconfig.json
          ├── vite.config.ts
          └── README.md
          ```
          
          ## Available Scripts
          
          - `npm run dev` - Start development server
          - `npm run build` - Build for production
          - `npm run preview` - Preview production build
          - `npm run lint` - Run ESLint
          EOF

      - name: Create repo and push
        env:
          GH_TOKEN: ${{ secrets.PAT_TOKEN }}
        run: |
          cd ${{ inputs.project_name }}
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"
          rm -rf .git
          git init
          git add .
          git commit -m "Initial React ${{ inputs.react_version }} + Vite project"
          gh repo create ${{ inputs.project_name }} --${{ inputs.repo_visibility }} --source . --push
          echo "✅ Done: https://github.com/${{ github.repository_owner }}/${{ inputs.project_name }}"
